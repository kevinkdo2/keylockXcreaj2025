<!-- views/empresa/paquete-qr.ejs (actualizado para manejar caracter√≠sticas NULL) -->
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>C√≥digo QR del Paquete | KeyLock</title>
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/dashboard.css">
  <link rel="stylesheet" href="/css/admin.css">
  <link rel="stylesheet" href="/css/paquetes.css">
    <link href="/css/output.css" rel="stylesheet">
  <link rel="icon" type="image/x-icon" href="/images/logo.png">
</head>
<body>
  <%- include('../partials/header') %>

  <main class="container admin-container">
    <div class="admin-header">
      <h1>C√≥digo QR del Paquete</h1>
      <p>Paquete registrado correctamente</p>
    </div>

    <div class="admin-menu">
      <a href="" class="admin-menu-item">
        <span class="icon">üìä</span>
        <span>Dashboard</span>
      </a>
      <a href="/empresa/paquetes" class="admin-menu-item active">
        <span class="icon">üì¶</span>
        <span>Paquetes</span>
      </a>
    </div>

    <div class="admin-content">
      <div class="qr-container">
        <div class="qr-info">
          <h2>Datos del Paquete</h2>
          <ul class="info-list">
            <li><strong>C√≥digo:</strong> <span class="destaque"><%= paquete.codigo_unico %></span></li>
            <li><strong>Destinatario:</strong> <%= paquete.nombre_usuario %></li>
            <li><strong>Remitente:</strong> <%= paquete.remitente %></li>
            <li><strong>Casillero:</strong> <%= paquete.ubicacion_casillero %></li>
            <li><strong>Tama√±o:</strong> <%= paquete.tamano_visual || (paquete.tamano === 'pequeno' ? 'Peque√±o' : 
                                             paquete.tamano === 'mediano' ? 'Mediano' : 
                                             paquete.tamano === 'grande' ? 'Grande' : 
                                             paquete.tamano || 'No especificado') %></li>
            <li><strong>Fecha de entrega:</strong> <%= new Date(paquete.fecha_entrega).toLocaleString('es-ES') %></li>
            
            <% if (paquete.caracteristicas && paquete.caracteristicas.toString().trim() !== '') { %>
            <li><strong>Caracter√≠sticas:</strong> <%= typeof paquete.caracteristicas === 'object' ? 
                                                    JSON.stringify(paquete.caracteristicas) : 
                                                    paquete.caracteristicas %></li>
            <% } %>
          </ul>
        </div>
        
        <div class="qr-code">
          <div class="qr-image">
            <img src="<%= qrDataURL %>" alt="C√≥digo QR del paquete">
          </div>
          <div class="qr-actions">
            <a href="<%= qrDataURL %>" download="codigo-<%= paquete.codigo_unico %>.png" class="btn btn-primary">
              <span class="icon">üíæ</span> Descargar QR
            </a>
            <button onclick="printQR()" class="btn btn-secondary">
              <span class="icon">üñ®Ô∏è</span> Imprimir QR
            </button>
          </div>
        </div>
      </div>
      
      <div class="qr-instructions">
        <h3>Instrucciones</h3>
        <p>Este c√≥digo QR contiene el identificador √∫nico del paquete. El destinatario deber√° presentar este c√≥digo al momento de recoger su paquete para su verificaci√≥n.</p>
        <p>Puede imprimir el c√≥digo QR o enviarlo por correo electr√≥nico al destinatario.</p>
      </div>
      
      <div class="form-actions centered">
        <a href="/empresa/paquetes" class="btn btn-secondary">Volver a la lista</a>
        <a href="/empresa/paquetes/create" class="btn btn-primary">Registrar otro paquete</a>
      </div>
    </div>
  </main>

  <footer>
    <p>&copy; 2025 Mi Aplicaci√≥n - Todos los derechos reservados</p>
  </footer>

  <script>
    // Funci√≥n para imprimir el QR
    function printQR() {
      const printContent = document.querySelector('.qr-container').innerHTML;
      const originalContent = document.body.innerHTML;
      
      document.body.innerHTML = `
        <div style="text-align: center; padding: 20px;">
          <h2>C√≥digo QR para Paquete: <%= paquete.codigo_unico %></h2>
          ${printContent}
        </div>
      `;
      
      window.print();
      document.body.innerHTML = originalContent;
      // Recargar scripts
      location.reload();
    }
  </script>
</body>
</html>